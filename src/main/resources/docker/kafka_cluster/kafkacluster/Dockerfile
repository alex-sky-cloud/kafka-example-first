#OpenJDK (Open Java Development Kit) - это бесплатная реализация платформы Java
# с открытым исходным кодом Standard Edition (Java SE).
# Данная команда указывает базовый образ, на основе которого будет создаваться
# образ, создание которого описывает данный файл
FROM openjdk

# Создаем переменную. нам нужно будет создать столько контейнеров, сколько нужно Node
# c kafka в данном кластере. Каждый Node должен иметь свой id.
ARG brokerId=1

# Данный образ должен быть скачан и находится в корне каталога
# где расположен данный Dockerfile
# данная команда копирует данный архив в создаваемый образ и распаковывает
# будет создан каталог с названием архива 'kafka-3.0.0-src'
ADD kafka_2.12-3.0.0.tgz /

# RUN — Используется для выполнения команды в ходе сборки образа.
# mv Указывает, что архив из каталога 'kafka-3.0.0-src' нужно переместить в каталог kafka
# в данном образе;
# sed указывает на изменение конфигурации
# Команда sed - это потоковый редактор текста, работающий по принципу замены
# Она в файле отредактирует строку 'zookeeper.connect=localhost:2181' и
# заменит ее на 'zookeeper.connect=zookeeper:2181'
# Также заменит строку 'broker.id=0' на 'broker.id=1', значение 1 будет взято из переменной 'brokerId=1'
RUN mv /kafka_2.12-3.0.0 /kafka && \
sed -i s/localhost:2181/zookeeper:2181/g /kafka/config/server.properties && \
sed -i s/broker.id=0/broker.id=${brokerId}/g /kafka/config/server.properties

# в контейнере будут выставлены (открыты) порты: 2181 (ZooKeeper) и 9092 (Kafka).
EXPOSE 2181 9092